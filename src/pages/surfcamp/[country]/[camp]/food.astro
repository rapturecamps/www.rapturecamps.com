---
import CampLayout from "@/components/layout/CampLayout.astro";
import CTASection from "@/components/sections/CTASection.astro";
import ImageBreak from "@/components/sections/ImageBreak.astro";
import { destinations } from "@/lib/data";
import { getDestinations, getCampBySlug } from "@/lib/sanity-data";

export async function getStaticPaths() {
  const allCamps = await getDestinations();
  return allCamps.map((d) => {
    const parts = d.slug.replace("/surfcamp/", "").split("/");
    return { params: { country: parts[0], camp: parts[1] } };
  });
}

const { country, camp } = Astro.params;
const campData = await getCampBySlug(camp!) || destinations.find((d) => d.slug === `/surfcamp/${country}/${camp}`);
const campTitle = campData?.name || camp!.split("-").map((w) => w.charAt(0).toUpperCase() + w.slice(1)).join(" ");
const countryTitle = country!.split("-").map((w) => w.charAt(0).toUpperCase() + w.slice(1)).join(" ");
const bookingUrl = campData?.bookingUrl || `https://bookings.rapturecamps.com/en/product/${country}-${camp}-surf-stay`;
const basePath = `/surfcamp/${country}/${camp}`;

const sanityData = (campData as any)?.foodPage;

const mealIcons: Record<string, string> = {
  "Breakfast": "M17 8h1a4 4 0 1 1 0 8h-1M3 8h14v9a4 4 0 0 1-4 4H7a4 4 0 0 1-4-4Z M6 2v4 M10 2v4 M14 2v4",
  "Lunch": "M3 2v7c0 1.1.9 2 2 2h4a2 2 0 0 0 2-2V2M7 2v20M21 15V2v0a5 5 0 0 0-5 5v6c0 1.1.9 2 2 2h3Zm0 0v7",
  "Dinner": "M3 2v7c0 1.1.9 2 2 2h4a2 2 0 0 0 2-2V2M7 2v20",
};

const mealImages = [
  "https://images.unsplash.com/photo-1504754524776-8f4f37790ca0?w=600&h=400&fit=crop",
  "https://images.unsplash.com/photo-1512621776951-a57141f2eefd?w=600&h=400&fit=crop",
  "https://images.unsplash.com/photo-1414235077428-338989a2e8c0?w=600&h=400&fit=crop",
];

const meals = (sanityData?.meals || [
  { meal: "Breakfast", time: "7:30 – 9:30", desc: "A proper spread to fuel your morning session. Fresh tropical fruit, eggs any way you like, homemade granola, smoothie bowls, pancakes, toast with local jams, and unlimited coffee and tea.", highlights: ["Fresh tropical fruit", "Eggs & pancakes to order", "Smoothie bowls", "Unlimited coffee & tea"] },
  { meal: "Lunch", time: "On the go", desc: "Between surf sessions, we keep it light and energising. Packed snacks, fresh fruit, and energy bars come with you to the beach.", highlights: ["Beach snack packs", "Fresh fruit & energy bars", "Hydration station", "Optional camp lunch"] },
  { meal: "Dinner", time: "19:00 – 20:30", desc: "The highlight of the day. Three-course dinners Monday through Friday, featuring a rotating menu of local and international dishes.", highlights: ["Three courses", "Rotating menu", "Local & international", "Mon – Fri"] },
]).map((m: any, i: number) => ({
  ...m,
  icon: mealIcons[m.meal] || mealIcons["Dinner"],
  image: m.image?.asset?.url || mealImages[i] || mealImages[0],
}));

const sampleMenu = sanityData?.sampleMenu?.length ? sanityData.sampleMenu : [
  { day: "Monday", starter: "Watermelon & feta salad", main: "Grilled mahi-mahi with lime rice", dessert: "Coconut panna cotta" },
  { day: "Tuesday", starter: "Tom kha soup", main: "Chicken satay with peanut noodles", dessert: "Mango sticky rice" },
  { day: "Wednesday", starter: "Bruschetta trio", main: "Homemade pasta with pesto & roast veg", dessert: "Tiramisu" },
  { day: "Thursday", starter: "Vietnamese summer rolls", main: "Slow-cooked beef rendang with jasmine rice", dessert: "Banana fritters with ice cream" },
  { day: "Friday", starter: "Garden salad with tahini", main: "BBQ mixed grill with grilled corn & slaw", dessert: "Chocolate fondant" },
];

const dietaryIcons: Record<string, { icon: string; color: string }> = {
  "Vegetarian": { icon: "M12 22c5.523 0 10-4.477 10-10S17.523 2 12 2 2 6.477 2 12s4.477 10 10 10z", color: "text-green-400" },
  "Vegan": { icon: "M17 8C8 10 5.9 16.17 3.82 21.34M2 11.5C7 11.5 11.17 7.67 12 2", color: "text-green-400" },
  "Gluten-Free": { icon: "M12 22c5.523 0 10-4.477 10-10S17.523 2 12 2 2 6.477 2 12s4.477 10 10 10z M4.93 4.93l14.14 14.14", color: "text-amber-400" },
  "Lactose-Free": { icon: "M12 22c5.523 0 10-4.477 10-10S17.523 2 12 2 2 6.477 2 12s4.477 10 10 10z M4.93 4.93l14.14 14.14", color: "text-amber-400" },
  "Halal": { icon: "M20 6 9 17l-5-5", color: "text-ocean-light" },
  "Nut-Free": { icon: "M20 6 9 17l-5-5", color: "text-ocean-light" },
};

const dietary = (sanityData?.dietary || [
  { name: "Vegetarian", desc: "Full veggie options at every meal" },
  { name: "Vegan", desc: "Plant-based dishes always available" },
  { name: "Gluten-Free", desc: "GF alternatives for every course" },
  { name: "Lactose-Free", desc: "Dairy-free options on request" },
  { name: "Halal", desc: "Halal-prepared meals available" },
  { name: "Nut-Free", desc: "Strict nut-free preparation possible" },
]).map((d: any) => ({
  ...d,
  ...(dietaryIcons[d.name] || { icon: "M20 6 9 17l-5-5", color: "text-white" }),
}));
---

<CampLayout
  campName={campTitle}
  countryName={countryTitle}
  basePath={basePath}
  activePage="food"
  bookingUrl={bookingUrl}
  heroImages={campData?.heroImages}
  title={`Food at ${campTitle} | Rapture Surfcamps`}
  description={`Discover the dining experience at Rapture Surf Camp ${campTitle}. Fresh, healthy meals prepared daily.`}
>
  <!-- Intro -->
  <section class="py-16 sm:py-20 bg-dark">
    <div class="px-6 sm:px-12 lg:px-20">
      <div class="grid grid-cols-1 lg:grid-cols-2 gap-10 lg:gap-16 items-start">
        <div>
          <h1 class="text-2xl sm:text-3xl lg:text-4xl font-semibold text-white mb-6">{sanityData?.introHeading || "Eat Well, Surf Better"}</h1>
          <div class="text-base sm:text-lg text-white/50 leading-relaxed space-y-4 max-w-xl">
            {(sanityData?.introBody || "Surfing burns serious energy — 400+ calories per session. That's why we take food as seriously as we take waves. Our chefs prepare fresh, nutritious meals daily using local ingredients, so you're always fuelled up and ready to paddle back out.\n\nEvery dietary requirement is catered for. Just let us know when you book and we'll make sure you're sorted from day one.").split("\n\n").map((p: string) => <p>{p}</p>)}
          </div>
        </div>
        <div class="rounded-xl border border-white/5 bg-dark-lighter p-6 sm:p-8">
          <h3 class="text-sm font-semibold text-white uppercase tracking-wider mb-5">At a Glance</h3>
          <div class="space-y-4">
            {(sanityData?.glanceItems || [
              { label: "Meals Included", value: "Breakfast & Dinner" },
              { label: "Dinner Nights", value: "Monday – Friday" },
              { label: "Saturday Night", value: "Pizza Night", note: "(at extra cost)" },
              { label: "Sunday Night", value: "BBQ", note: "(at extra cost)" },
              { label: "Cuisine Style", value: "Local & International" },
              { label: "Special Diets", value: "All catered for" },
              { label: "Drinks", value: "Coffee, tea & water all day" },
            ]).map((item: any, i: number, arr: any[]) => (
              <div class:list={["flex justify-between items-center pb-3", i < arr.length - 1 && "border-b border-white/5"]}>
                <span class="text-sm text-white/40">{item.label}</span>
                <span class="text-sm text-white font-medium">
                  {item.note && <span class="text-white/30 font-normal">{item.note} </span>}
                  {item.value}
                </span>
              </div>
            ))}
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- Daily Meals -->
  <section class="py-16 sm:py-20 bg-dark-lighter">
    <div class="px-6 sm:px-12 lg:px-20">
      <h2 class="text-2xl sm:text-3xl lg:text-4xl font-semibold text-white mb-10">Daily Meals</h2>
      <div class="space-y-8">
        {meals.map((m, i) => (
          <div class:list={[
            "grid grid-cols-1 lg:grid-cols-5 gap-6 rounded-xl border border-white/5 bg-dark overflow-hidden",
          ]}>
            <div class:list={["aspect-[16/10] lg:aspect-auto lg:col-span-2 overflow-hidden", i % 2 === 1 && "lg:order-2"]}>
              <img
                src={m.image}
                alt={m.meal}
                class="h-full w-full object-cover"
                loading="lazy"
              />
            </div>
            <div class:list={["lg:col-span-3 p-6 sm:p-8 flex flex-col justify-center", i % 2 === 1 && "lg:order-1"]}>
              <div class="flex items-center gap-4 mb-4">
                <div class="flex h-10 w-10 flex-shrink-0 items-center justify-center rounded-lg bg-white/5 text-white/40">
                  <svg class="h-5 w-5" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
                    <path d={m.icon} />
                  </svg>
                </div>
                <div>
                  <h3 class="text-lg font-semibold text-white">{m.meal}</h3>
                  <span class="text-xs text-ocean-light">{m.time}</span>
                </div>
              </div>
              <p class="text-sm text-white/50 leading-relaxed mb-5">{m.desc}</p>
              <div class="grid grid-cols-2 gap-2">
                {m.highlights.map((h) => (
                  <span class="flex items-center gap-2 text-xs text-white/40">
                    <svg class="h-3 w-3 text-ocean-light/60 flex-shrink-0" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M20 6 9 17l-5-5"/></svg>
                    {h}
                  </span>
                ))}
              </div>
            </div>
          </div>
        ))}
      </div>
    </div>
  </section>

  <!-- Image Break -->
  <ImageBreak
    src={sanityData?.imageBreakUrl || "https://images.unsplash.com/photo-1498837167922-ddd27525d352?w=1920&h=800&fit=crop"}
    alt={sanityData?.imageBreakAlt || "Fresh food preparation"}
    caption={sanityData?.imageBreakCaption || "Fresh, local ingredients — prepared daily by our chefs"}
    height="short"
  />

  <!-- Sample Weekly Menu -->
  <section class="py-16 sm:py-20 bg-dark">
    <div class="px-6 sm:px-12 lg:px-20">
      <h2 class="text-2xl sm:text-3xl lg:text-4xl font-semibold text-white mb-3">{sanityData?.menuHeading || "Sample Weekly Menu"}</h2>
      <p class="text-base text-white/40 mb-10 max-w-2xl">{sanityData?.menuSubtext || "Our menu rotates weekly to keep things fresh. Here's a taste of what a typical dinner week looks like."}</p>

      <!-- Desktop table -->
      <div class="hidden md:block overflow-hidden rounded-xl border border-white/5">
        <table class="w-full">
          <thead>
            <tr class="bg-dark-lighter">
              <th class="px-5 py-3 text-left text-xs font-semibold text-white/60 uppercase tracking-wider">Day</th>
              <th class="px-5 py-3 text-left text-xs font-semibold text-white/60 uppercase tracking-wider">Starter</th>
              <th class="px-5 py-3 text-left text-xs font-semibold text-white/60 uppercase tracking-wider">Main</th>
              <th class="px-5 py-3 text-left text-xs font-semibold text-white/60 uppercase tracking-wider">Dessert</th>
            </tr>
          </thead>
          <tbody>
            {sampleMenu.map((row, i) => (
              <tr class:list={[i % 2 === 0 ? "bg-dark" : "bg-dark-lighter/50", "border-t border-white/5"]}>
                <td class="px-5 py-4 text-sm font-medium text-white">{row.day}</td>
                <td class="px-5 py-4 text-sm text-white/50">{row.starter}</td>
                <td class="px-5 py-4 text-sm text-white/50">{row.main}</td>
                <td class="px-5 py-4 text-sm text-white/50">{row.dessert}</td>
              </tr>
            ))}
          </tbody>
        </table>
      </div>

      <!-- Mobile cards -->
      <div class="md:hidden space-y-4">
        {sampleMenu.map((row) => (
          <div class="p-5 rounded-xl bg-dark-lighter border border-white/5">
            <h3 class="text-sm font-semibold text-white mb-3">{row.day}</h3>
            <div class="space-y-2 text-xs text-white/50">
              <div class="flex gap-2">
                <span class="text-white/30 w-14 flex-shrink-0">Starter</span>
                <span>{row.starter}</span>
              </div>
              <div class="flex gap-2">
                <span class="text-white/30 w-14 flex-shrink-0">Main</span>
                <span>{row.main}</span>
              </div>
              <div class="flex gap-2">
                <span class="text-white/30 w-14 flex-shrink-0">Dessert</span>
                <span>{row.dessert}</span>
              </div>
            </div>
          </div>
        ))}
      </div>
    </div>
  </section>

  <!-- Dietary Requirements -->
  <section class="py-16 sm:py-20 bg-dark-lighter">
    <div class="px-6 sm:px-12 lg:px-20">
      <h2 class="text-2xl sm:text-3xl lg:text-4xl font-semibold text-white mb-3">{sanityData?.dietaryHeading || "Dietary Requirements"}</h2>
      <p class="text-base text-white/40 mb-10 max-w-2xl">{sanityData?.dietarySubtext || "Everyone eats well here. Let us know your needs when booking and our chefs will take care of the rest."}</p>
      <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-5">
        {dietary.map((d) => (
          <div class="flex items-start gap-4 p-5 rounded-xl bg-dark border border-white/5">
            <div class:list={["flex h-10 w-10 flex-shrink-0 items-center justify-center rounded-lg bg-white/5", d.color]}>
              <svg class="h-5 w-5" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
                <path d={d.icon} />
              </svg>
            </div>
            <div>
              <h3 class="text-sm font-semibold text-white mb-0.5">{d.name}</h3>
              <p class="text-xs text-white/40">{d.desc}</p>
            </div>
          </div>
        ))}
      </div>
    </div>
  </section>

  <!-- Food Gallery Strip -->
  <section class="bg-dark">
    <div class="grid grid-cols-2 sm:grid-cols-4">
      {(sanityData?.galleryImages || [
        { url: "https://images.unsplash.com/photo-1490645935967-10de6ba17061?w=500&h=400&fit=crop", alt: "Breakfast spread" },
        { url: "https://images.unsplash.com/photo-1504674900247-0877df9cc836?w=500&h=400&fit=crop", alt: "Plated dinner" },
        { url: "https://images.unsplash.com/photo-1494597564530-871f2b93ac55?w=500&h=400&fit=crop", alt: "Tropical smoothie bowls" },
        { url: "https://images.unsplash.com/photo-1555939594-58d7cb561ad1?w=500&h=400&fit=crop", alt: "BBQ night" },
      ]).map((img: any) => (
        <div class="aspect-square overflow-hidden">
          <img src={img.url} alt={img.alt} class="h-full w-full object-cover" loading="lazy" />
        </div>
      ))}
    </div>
  </section>

  <CTASection />
</CampLayout>
