---
import CampLayout from "@/components/layout/CampLayout.astro";
import BlockRenderer from "@/components/blocks/BlockRenderer.astro";
import CTASection from "@/components/sections/CTASection.astro";
import { destinations } from "@/lib/data";
import { getDestinations, getCampBySlug } from "@/lib/sanity-data";

export async function getStaticPaths() {
  const allCamps = await getDestinations();
  return allCamps.map((d) => {
    const parts = d.slug.replace("/surfcamp/", "").split("/");
    return { params: { country: parts[0], camp: parts[1] } };
  });
}

const { country, camp } = Astro.params;
const campData = await getCampBySlug(camp!) || destinations.find((d) => d.slug === `/surfcamp/${country}/${camp}`);
const campTitle = campData?.name || camp!.split("-").map((w) => w.charAt(0).toUpperCase() + w.slice(1)).join(" ");
const countryTitle = country!.split("-").map((w) => w.charAt(0).toUpperCase() + w.slice(1)).join(" ");
const bookingUrl = campData?.bookingUrl || `https://bookings.rapturecamps.com/en/product/${country}-${camp}-surf-stay`;
const basePath = `/surfcamp/${country}/${camp}`;

const blocks = (campData as any)?.foodPageBuilder;
---

<CampLayout
  campName={campTitle}
  countryName={countryTitle}
  basePath={basePath}
  activePage="food"
  bookingUrl={bookingUrl}
  heroImages={campData?.heroImages}
  title={`Food at ${campTitle} | Rapture Surfcamps`}
  description={`Discover the dining experience at Rapture Surf Camp ${campTitle}. Fresh, healthy meals prepared daily.`}
>
  {blocks?.length ? (
    <BlockRenderer blocks={blocks} campData={campData} />
  ) : (
    <CTASection />
  )}
</CampLayout>
