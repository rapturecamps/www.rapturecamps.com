---
import CampLayout from "@/components/layout/CampLayout.astro";
import CTASection from "@/components/sections/CTASection.astro";
import ImageBreak from "@/components/sections/ImageBreak.astro";
import ContentBlock from "@/components/sections/ContentBlock.astro";
import { destinations } from "@/lib/data";

export function getStaticPaths() {
  return destinations.map((d) => {
    const parts = d.slug.replace("/surfcamp/", "").split("/");
    return { params: { country: parts[0], camp: parts[1] } };
  });
}

const { country, camp } = Astro.params;
const campData = destinations.find((d) => d.slug === `/surfcamp/${country}/${camp}`);
const campTitle = campData?.name || camp!.split("-").map((w) => w.charAt(0).toUpperCase() + w.slice(1)).join(" ");
const countryTitle = country!.split("-").map((w) => w.charAt(0).toUpperCase() + w.slice(1)).join(" ");
const bookingUrl = campData?.bookingUrl || `https://bookings.rapturecamps.com/en/product/${country}-${camp}-surf-stay/guests`;
const basePath = `/surfcamp/${country}/${camp}`;

const surfSpots = [
  {
    name: "Main Beach Break",
    level: "All Levels",
    type: "Beach Break",
    image: "https://images.unsplash.com/photo-1502933691298-84fc14542831?w=600&h=400&fit=crop",
    desc: "Our go-to spot for daily lessons. Consistent, forgiving waves with a sandy bottom — perfect for building confidence and progressing fast.",
  },
  {
    name: "The Reef",
    level: "Intermediate+",
    type: "Reef Break",
    image: "https://images.unsplash.com/photo-1507525428034-b723cf961d3e?w=600&h=400&fit=crop",
    desc: "A fast, hollow right-hander breaking over coral. Best on mid-tide with a south swell. Booties recommended.",
  },
  {
    name: "Secret Point",
    level: "Advanced",
    type: "Point Break",
    image: "https://images.unsplash.com/photo-1518548419970-58e3b4079ab2?w=600&h=400&fit=crop",
    desc: "Long, peeling left-hander wrapping around the headland. Can hold overhead swells and offers 200m+ rides on the right day.",
  },
];

const schedule = [
  { time: "06:30", activity: "Wake-up & light stretch", icon: "M12 3a6 6 0 0 0 9 9 9 9 0 0 1-9-9Z M6.34 17.66 4 22 M17.66 17.66 20 22" },
  { time: "07:00", activity: "Breakfast buffet", icon: "M17 8h1a4 4 0 1 1 0 8h-1M3 8h14v9a4 4 0 0 1-4 4H7a4 4 0 0 1-4-4Z" },
  { time: "08:00", activity: "Surf theory & video analysis", icon: "M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z" },
  { time: "08:30", activity: "Morning surf session (2–3 hrs)", icon: "M2 6c.6.5 1.2 1 2.5 1C7 7 7 5 9.5 5c2.6 0 2.4 2 5 2 2.5 0 2.5-2 5-2 1.3 0 1.9.5 2.5 1" },
  { time: "12:00", activity: "Lunch & free time", icon: "M3 2v7c0 1.1.9 2 2 2h4a2 2 0 0 0 2-2V2M7 2v20M21 15V2v0a5 5 0 0 0-5 5v6c0 1.1.9 2 2 2h3Zm0 0v7" },
  { time: "14:00", activity: "Yoga or recovery session", icon: "M18 8a6 6 0 0 1-6 6 6 6 0 0 1-6-6" },
  { time: "15:00", activity: "Afternoon surf session (2 hrs)", icon: "M2 12c.6.5 1.2 1 2.5 1 2.5 0 2.5-2 5-2s2.4 2 5 2c2.5 0 2.5-2 5-2 1.3 0 1.9.5 2.5 1" },
  { time: "17:30", activity: "Sunset beers & video review", icon: "M23 7l-7 5 7 5V7z M16 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h11a2 2 0 0 0 2-2V5a2 2 0 0 0-2-2z" },
  { time: "19:00", activity: "Dinner", icon: "M3 2v7c0 1.1.9 2 2 2h4a2 2 0 0 0 2-2V2" },
];

const levels = [
  {
    level: "Beginner",
    subtitle: "Never surfed or still learning to stand",
    features: [
      "Pop-up technique on the beach",
      "Paddling and wave selection",
      "Riding whitewater to green waves",
      "Ocean safety & etiquette",
    ],
    outcome: "By the end of the week, you'll be standing up and riding unbroken green waves.",
    color: "text-green-400",
    bgColor: "bg-green-400/10",
  },
  {
    level: "Intermediate",
    subtitle: "You can stand up and ride the wave face",
    features: [
      "Bottom turns & top turns",
      "Reading the lineup & positioning",
      "Generating speed on the face",
      "Duck diving & wave selection",
    ],
    outcome: "You'll leave with cleaner turns, better wave reading, and the confidence to surf new spots.",
    color: "text-ocean-light",
    bgColor: "bg-ocean-light/10",
  },
  {
    level: "Advanced",
    subtitle: "Experienced surfer looking for the best waves",
    features: [
      "Guided sessions at reef and point breaks",
      "Barrel riding techniques",
      "Aerial progression",
      "Swell and wind forecasting",
    ],
    outcome: "Our instructors take you to the best breaks for the conditions — spots you'd never find on your own.",
    color: "text-amber-400",
    bgColor: "bg-amber-400/10",
  },
];

const equipment = [
  { item: "Surfboards", desc: "Soft-tops, funboards, shortboards, and longboards — matched to your level", icon: "M17.5 2.5c1 1 1.5 3.5.5 7s-3.5 7-6.5 9.5c-1 .8-2 1.2-2.5 1.5-.5-.3-1.5-.7-2.5-1.5-3-2.5-5.5-6-6.5-9.5s-.5-6 .5-7 3-.5 5.5.5 4 2.5 5.5 2.5 3.5-1.5 5.5-2.5 4.5-1.5 5.5-.5z" },
  { item: "Wetsuits", desc: "Premium wetsuits in all sizes. Thickness matched to water temperature", icon: "M16 2l-4 3-4-3-3.46 1.46a2 2 0 0 0-.54 1.37V10l-1 1v5h2v4a2 2 0 0 0 2 2h6a2 2 0 0 0 2-2v-4h2v-5l-1-1V4.83a2 2 0 0 0-.54-1.37z" },
  { item: "Rash Vests", desc: "Sun protection for warm-water sessions when you don't need a full suit", icon: "M20.38 3.46L16 2l-4 3.5L8 2 3.62 3.46a2 2 0 0 0-1.34 2.23l.58 3.47a1 1 0 0 0 .99.84H6v10c0 1.1.9 2 2 2h8a2 2 0 0 0 2-2V10h2.15a1 1 0 0 0 .99-.84l.58-3.47a2 2 0 0 0-1.34-2.23z" },
  { item: "Reef Booties", desc: "Available for reef sessions — protects your feet on sharp coral", icon: "M5 22h4a2 2 0 0 0 2-2v-3a1 1 0 0 1 1-1h0a1 1 0 0 1 1 1v3a2 2 0 0 0 2 2h4v-5a7 7 0 0 0-7-7h0a7 7 0 0 0-7 7z" },
];
---

<CampLayout
  campName={campTitle}
  countryName={countryTitle}
  basePath={basePath}
  activePage="surf"
  bookingUrl={bookingUrl}
  heroImages={campData?.heroImages}
  title={`Surf at ${campTitle} | Rapture Surfcamps`}
  description={`Discover the surf spots, conditions, and lessons at Rapture Surf Camp ${campTitle} in ${countryTitle}.`}
>
  <!-- Intro -->
  <section class="py-16 sm:py-20 bg-dark">
    <div class="px-6 sm:px-12 lg:px-20">
      <div class="grid grid-cols-1 lg:grid-cols-2 gap-10 lg:gap-16 items-start">
        <div>
          <h1 class="text-2xl sm:text-3xl lg:text-4xl font-semibold text-white mb-6">The Waves</h1>
          <div class="text-base sm:text-lg text-white/50 leading-relaxed space-y-4 max-w-xl">
            <p>The coastline around {campTitle} is stacked with surf breaks for every level. From gentle beach breaks perfect for your first pop-up to fast reef passes that'll get your heart pumping — there's a wave for every day and every surfer.</p>
            <p>Our instructors have been surfing these waters for years. They know exactly where to go based on the swell, wind, and tide — so you're always in the right spot at the right time.</p>
          </div>
        </div>
        <div
          class="surf-conditions-card rounded-xl border border-white/5 bg-dark-lighter p-6 sm:p-8"
          data-lat={campData?.latitude}
          data-lng={campData?.longitude}
        >
          <div class="flex items-center justify-between mb-5">
            <h3 class="text-sm font-semibold text-white uppercase tracking-wider">Surf Conditions</h3>
            <span class="surf-live-badge hidden items-center gap-1.5 rounded-full bg-green-500/10 border border-green-500/20 px-2.5 py-1">
              <span class="relative flex h-1.5 w-1.5">
                <span class="absolute inline-flex h-full w-full animate-ping rounded-full bg-green-400 opacity-75"></span>
                <span class="relative inline-flex h-1.5 w-1.5 rounded-full bg-green-500"></span>
              </span>
              <span class="text-[10px] uppercase tracking-wider text-green-400 font-semibold">Live</span>
            </span>
          </div>
          <div class="space-y-4">
            <!-- Static rows -->
            <div class="flex justify-between items-center border-b border-white/5 pb-3">
              <span class="text-sm text-white/40">Wave Type</span>
              <span class="text-sm text-white font-medium">Beach, Reef & Point</span>
            </div>
            <div class="flex justify-between items-center border-b border-white/5 pb-3">
              <span class="text-sm text-white/40">Peak Season</span>
              <span class="text-sm text-white font-medium">May – October</span>
            </div>
            <div class="flex justify-between items-center border-b border-white/5 pb-3">
              <span class="text-sm text-white/40">Surf Spots Within Reach</span>
              <span class="text-sm text-white font-medium">15+</span>
            </div>

            <!-- Live data rows (show fallback values, replaced by API) -->
            <div class="pt-1">
              <p class="text-[10px] uppercase tracking-wider text-white/20 mb-3">Current conditions</p>
            </div>
            <div class="flex justify-between items-center border-b border-white/5 pb-3">
              <span class="text-sm text-white/40">Wave Height</span>
              <span class="text-sm text-white font-medium surf-live-wave-height">—</span>
            </div>
            <div class="flex justify-between items-center border-b border-white/5 pb-3">
              <span class="text-sm text-white/40">Wave Period</span>
              <span class="text-sm text-white font-medium surf-live-wave-period">—</span>
            </div>
            <div class="flex justify-between items-center border-b border-white/5 pb-3">
              <span class="text-sm text-white/40">Swell Height</span>
              <span class="text-sm text-white font-medium surf-live-swell-height">—</span>
            </div>
            <div class="flex justify-between items-center">
              <span class="text-sm text-white/40">Swell Direction</span>
              <span class="text-sm text-white font-medium surf-live-swell-dir">—</span>
            </div>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- 14-Day Surf Forecast -->
  <section class="py-12 sm:py-16 bg-dark-lighter">
    <div class="px-6 sm:px-12 lg:px-20">
      <div class="flex items-center justify-between mb-8">
        <div>
          <div class="flex items-center gap-3 mb-2">
            <h2 class="text-xl sm:text-2xl font-semibold text-white">Surf Forecast</h2>
            <span class="forecast-live-badge hidden items-center gap-1.5 rounded-full bg-green-500/10 border border-green-500/20 px-2 py-0.5">
              <span class="relative flex h-1.5 w-1.5">
                <span class="absolute inline-flex h-full w-full animate-ping rounded-full bg-green-400 opacity-75"></span>
                <span class="relative inline-flex h-1.5 w-1.5 rounded-full bg-green-500"></span>
              </span>
              <span class="text-[10px] uppercase tracking-wider text-green-400 font-semibold">Live</span>
            </span>
          </div>
          <p class="text-sm text-white/40">Wave and swell forecast for the next 14 days</p>
        </div>
        <div class="hidden sm:flex items-center gap-3 text-[10px] uppercase tracking-wider text-white/30">
          <span class="flex items-center gap-1.5"><span class="h-2 w-2 rounded-full bg-green-400"></span> Mellow</span>
          <span class="flex items-center gap-1.5"><span class="h-2 w-2 rounded-full bg-ocean-light"></span> Fun</span>
          <span class="flex items-center gap-1.5"><span class="h-2 w-2 rounded-full bg-amber-400"></span> Pumping</span>
        </div>
      </div>

      <!-- Forecast skeleton / container -->
      <div class="forecast-container relative">
        <div class="forecast-scroll flex gap-3 overflow-x-auto pb-4 snap-x snap-mandatory scrollbar-hide" style="-webkit-overflow-scrolling: touch;">
          <!-- Cards injected by JS -->
          <div class="forecast-placeholder flex items-center justify-center w-full py-12">
            <div class="flex items-center gap-3 text-white/20">
              <svg class="h-5 w-5 animate-spin" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 2v4M12 18v4M4.93 4.93l2.83 2.83M16.24 16.24l2.83 2.83M2 12h4M18 12h4M4.93 19.07l2.83-2.83M16.24 7.76l2.83-2.83"/></svg>
              <span class="text-sm">Loading forecast&hellip;</span>
            </div>
          </div>
        </div>

        <!-- Scroll fade edges -->
        <div class="pointer-events-none absolute inset-y-0 left-0 w-8 bg-gradient-to-r from-dark-lighter to-transparent z-10 hidden forecast-fade-left"></div>
        <div class="pointer-events-none absolute inset-y-0 right-0 w-8 bg-gradient-to-l from-dark-lighter to-transparent z-10"></div>
      </div>

      <p class="text-[11px] text-white/15 mt-3">Data from Open-Meteo Marine API. Updated hourly. Forecasts beyond 7 days are less reliable.</p>
    </div>
  </section>

  <!-- Image break -->
  <ImageBreak
    src="https://images.unsplash.com/photo-1502933691298-84fc14542831?w=1920&h=800&fit=crop"
    alt={`Surfer riding a wave near ${campTitle}`}
    caption={`The lineup near ${campTitle}`}
    height="short"
  />

  <!-- Surf Spots -->
  <section class="py-16 sm:py-20 bg-dark">
    <div class="px-6 sm:px-12 lg:px-20">
      <h2 class="text-2xl sm:text-3xl lg:text-4xl font-semibold text-white mb-3">Surf Spots Nearby</h2>
      <p class="text-base text-white/40 mb-10 max-w-2xl">We rotate between 15+ breaks depending on conditions. Here are some of the highlights.</p>
      <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
        {surfSpots.map((spot) => (
          <div class="group rounded-xl overflow-hidden border border-white/5 bg-dark-lighter">
            <div class="aspect-[3/2] overflow-hidden">
              <img
                src={spot.image}
                alt={spot.name}
                class="h-full w-full object-cover transition-transform duration-500 group-hover:scale-105"
                loading="lazy"
              />
            </div>
            <div class="p-5">
              <div class="flex items-center gap-2 mb-2">
                <h3 class="text-base font-semibold text-white">{spot.name}</h3>
              </div>
              <div class="flex gap-2 mb-3">
                <span class="text-[10px] uppercase tracking-wider text-ocean-light bg-ocean-light/10 rounded-full px-2.5 py-0.5">{spot.level}</span>
                <span class="text-[10px] uppercase tracking-wider text-white/30 bg-white/5 rounded-full px-2.5 py-0.5">{spot.type}</span>
              </div>
              <p class="text-sm text-white/40 leading-relaxed">{spot.desc}</p>
            </div>
          </div>
        ))}
      </div>
    </div>
  </section>

  <!-- Surf Lessons -->
  <ContentBlock
    heading="Surf Lessons & Coaching"
    body="<p>Every session starts with a plan. Our ISA-certified instructors analyse the conditions, match you to the right break, and set goals for the session. In the water, they're right there with you — correcting your stance, helping you read the waves, pushing you just enough.</p><p>We keep groups to a maximum of 5 surfers per instructor, so you get genuine one-on-one attention. After each session, we review video footage together so you can see exactly what to work on. It's the fastest way to improve.</p>"
    image="https://images.unsplash.com/photo-1504681869696-d977211a5f4c?w=800&h=600&fit=crop"
    imageAlt={`Surf coaching at ${campTitle}`}
    background="dark-lighter"
  />

  <!-- Surf Levels -->
  <section class="py-16 sm:py-20 bg-dark">
    <div class="px-6 sm:px-12 lg:px-20">
      <h2 class="text-2xl sm:text-3xl lg:text-4xl font-semibold text-white mb-3">Your Surf Level</h2>
      <p class="text-base text-white/40 mb-10 max-w-2xl">Whether it's your first wave or your thousandth, we have a programme tailored for you.</p>
      <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
        {levels.map((item, i) => (
          <div class="surf-level-card rounded-xl border border-white/5 bg-dark-lighter p-6 flex flex-col" data-level={i}>
            <!-- Header (always visible) -->
            <div class="flex items-center justify-between">
              <div class="flex items-center gap-3">
                <span class:list={["inline-block h-2 w-2 rounded-full", item.color === "text-green-400" ? "bg-green-400" : item.color === "text-ocean-light" ? "bg-ocean-light" : "bg-amber-400"]} />
                <h3 class="text-lg font-semibold text-white">{item.level}</h3>
              </div>
              <button class="surf-level-toggle flex h-8 w-8 items-center justify-center rounded-full bg-white/5 text-white/40 hover:bg-white/10 hover:text-white transition-colors" aria-label={`Expand ${item.level} details`}>
                <svg class="surf-level-chevron h-4 w-4 transition-transform duration-300" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m6 9 6 6 6-6"/></svg>
              </button>
            </div>
            <p class:list={["text-xs mt-1", item.color]}>{item.subtitle}</p>

            <!-- Always visible content -->
            <ul class="space-y-2.5 mt-5 mb-5 flex-1">
              {item.features.map((f) => (
                <li class="flex items-start gap-2.5 text-sm text-white/50">
                  <svg class="h-4 w-4 mt-0.5 text-white/20 flex-shrink-0" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M20 6 9 17l-5-5"/></svg>
                  {f}
                </li>
              ))}
            </ul>
            <div class:list={["rounded-lg p-3 text-xs leading-relaxed", item.bgColor, item.color]}>
              {item.outcome}
            </div>

            <!-- Expandable extra content -->
            <div class="surf-level-body overflow-hidden transition-all duration-300 ease-in-out" style="max-height: 0; opacity: 0;">
              <div class="pt-5 border-t border-white/5 mt-5">
                <p class="text-sm text-white/50 leading-relaxed">{item.extra || "More details coming soon — including typical session breakdowns, recommended board types, and progression milestones."}</p>
              </div>
            </div>
          </div>
        ))}
      </div>

      <script is:inline>
      (function () {
        document.querySelectorAll(".surf-level-card").forEach(function (card) {
          var toggle = card.querySelector(".surf-level-toggle");
          var body = card.querySelector(".surf-level-body");
          var chevron = card.querySelector(".surf-level-chevron");
          if (!toggle || !body) return;

          var open = false;

          function expand() {
            body.style.maxHeight = body.scrollHeight + "px";
            body.style.opacity = "1";
            if (chevron) chevron.style.transform = "rotate(180deg)";
            card.style.borderColor = "rgba(255,255,255,0.1)";
            open = true;
          }

          function collapse() {
            body.style.maxHeight = "0";
            body.style.opacity = "0";
            if (chevron) chevron.style.transform = "rotate(0deg)";
            card.style.borderColor = "";
            open = false;
          }

          toggle.addEventListener("click", function () {
            if (open) collapse(); else expand();
          });
        });
      })();
      </script>
    </div>
  </section>

  <!-- A Typical Surf Day -->
  <section class="py-16 sm:py-20 bg-dark-lighter">
    <div class="px-6 sm:px-12 lg:px-20">
      <h2 class="text-2xl sm:text-3xl lg:text-4xl font-semibold text-white mb-3">A Typical Surf Day</h2>
      <p class="text-base text-white/40 mb-10 max-w-2xl">Every day is different depending on conditions, but here's what a standard day at {campTitle} looks like.</p>
      <div class="max-w-2xl">
        <div class="relative">
          <div class="absolute left-[19px] top-3 bottom-3 w-px bg-white/10" />
          <div class="space-y-0">
            {schedule.map((s, i) => (
              <div class="relative flex items-start gap-5 py-3">
                <div class="relative z-10 flex h-10 w-10 flex-shrink-0 items-center justify-center rounded-full bg-dark border border-white/10">
                  <svg class="h-4 w-4 text-white/40" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
                    <path d={s.icon} />
                  </svg>
                </div>
                <div class="pt-2">
                  <span class="text-xs text-ocean-light font-medium tracking-wide">{s.time}</span>
                  <p class="text-sm text-white/60 mt-0.5">{s.activity}</p>
                </div>
              </div>
            ))}
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- Boards & Equipment -->
  <section class="py-16 sm:py-20 bg-dark">
    <div class="px-6 sm:px-12 lg:px-20">
      <h2 class="text-2xl sm:text-3xl lg:text-4xl font-semibold text-white mb-3">Boards & Equipment</h2>
      <p class="text-base text-white/40 mb-10 max-w-2xl">Everything you need is included. Just bring yourself and a sense of adventure.</p>
      <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-5">
        {equipment.map((e) => (
          <div class="p-5 rounded-xl bg-dark-lighter border border-white/5">
            <div class="flex h-10 w-10 items-center justify-center rounded-lg bg-ocean-light/10 text-ocean-light mb-4">
              <svg class="h-5 w-5" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
                <path d={e.icon} />
              </svg>
            </div>
            <h3 class="text-sm font-semibold text-white mb-1">{e.item}</h3>
            <p class="text-xs text-white/40 leading-relaxed">{e.desc}</p>
          </div>
        ))}
      </div>
    </div>
  </section>

  <CTASection />

  <script is:inline>
  (function () {
    var card = document.querySelector(".surf-conditions-card");
    if (!card) return;
    var lat = card.getAttribute("data-lat");
    var lng = card.getAttribute("data-lng");
    if (!lat || !lng) return;

    var url = "https://marine-api.open-meteo.com/v1/marine"
      + "?latitude=" + lat
      + "&longitude=" + lng
      + "&current=wave_height,wave_period,wave_direction,swell_wave_height,swell_wave_period,swell_wave_direction"
      + "&daily=wave_height_max,wave_period_max,wave_direction_dominant,swell_wave_height_max,swell_wave_period_max,swell_wave_direction_dominant"
      + "&forecast_days=14&timezone=auto";

    var DAYS = ["Sun","Mon","Tue","Wed","Thu","Fri","Sat"];
    var MONTHS = ["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];

    function degToCompass(deg) {
      var dirs = ["N","NNE","NE","ENE","E","ESE","SE","SSE","S","SSW","SW","WSW","W","WNW","NW","NNW"];
      return dirs[Math.round(deg / 22.5) % 16];
    }

    function waveColor(h) {
      if (h == null) return { dot: "bg-white/20", bg: "border-white/5", text: "text-white/30" };
      if (h < 1.0) return { dot: "bg-green-400", bg: "border-green-500/20", text: "text-green-400" };
      if (h < 2.0) return { dot: "bg-ocean-light", bg: "border-ocean/30", text: "text-ocean-light" };
      return { dot: "bg-amber-400", bg: "border-amber-500/20", text: "text-amber-400" };
    }

    function updateCurrent(data) {
      var c = data.current;
      if (!c) return;

      var badge = card.querySelector(".surf-live-badge");
      if (badge) { badge.classList.remove("hidden"); badge.classList.add("flex"); }

      var wh = card.querySelector(".surf-live-wave-height");
      var wp = card.querySelector(".surf-live-wave-period");
      var sh = card.querySelector(".surf-live-swell-height");
      var sd = card.querySelector(".surf-live-swell-dir");

      if (wh && c.wave_height != null) wh.textContent = c.wave_height.toFixed(1) + " m";
      if (wp && c.wave_period != null) wp.textContent = c.wave_period.toFixed(0) + " s";
      if (sh && c.swell_wave_height != null) sh.textContent = c.swell_wave_height.toFixed(1) + " m";
      if (sd && c.swell_wave_direction != null) sd.textContent = degToCompass(c.swell_wave_direction) + " (" + Math.round(c.swell_wave_direction) + "°)";
    }

    function buildForecast(data) {
      var d = data.daily;
      if (!d || !d.time) return;

      var scroll = document.querySelector(".forecast-scroll");
      var placeholder = document.querySelector(".forecast-placeholder");
      var badge = document.querySelector(".forecast-live-badge");
      if (!scroll) return;
      if (placeholder) placeholder.remove();
      if (badge) { badge.classList.remove("hidden"); badge.classList.add("flex"); }

      var today = new Date();
      today.setHours(0, 0, 0, 0);

      for (var i = 0; i < d.time.length; i++) {
        var wh = d.wave_height_max[i];
        var wp = d.wave_period_max[i];
        var wd = d.wave_direction_dominant[i];
        var sh = d.swell_wave_height_max[i];
        var sp = d.swell_wave_period_max[i];
        var sd = d.swell_wave_direction_dominant[i];

        if (wh == null && sh == null) continue;

        var date = new Date(d.time[i] + "T00:00:00");
        var isToday = date.getTime() === today.getTime();
        var colors = waveColor(wh);

        var el = document.createElement("div");
        el.className = "flex-shrink-0 w-[140px] sm:w-[155px] rounded-xl border bg-dark p-4 snap-start transition-colors " + colors.bg;
        if (isToday) el.className += " ring-1 ring-ocean/30";

        var dayLabel = isToday ? "Today" : DAYS[date.getDay()];
        var dateLabel = date.getDate() + " " + MONTHS[date.getMonth()];

        var html = '<div class="flex items-center justify-between mb-3">'
          + '<div>'
          + '<p class="text-xs font-semibold text-white">' + dayLabel + '</p>'
          + '<p class="text-[10px] text-white/30">' + dateLabel + '</p>'
          + '</div>'
          + '<span class="h-2.5 w-2.5 rounded-full ' + colors.dot + '"></span>'
          + '</div>';

        html += '<div class="space-y-2.5">';

        if (wh != null) {
          html += '<div>'
            + '<p class="text-[10px] text-white/25 uppercase tracking-wider">Waves</p>'
            + '<p class="text-lg font-semibold ' + colors.text + '">' + wh.toFixed(1) + ' <span class="text-xs font-normal text-white/30">m</span></p>'
            + '</div>';
        }

        if (wp != null) {
          html += '<div class="flex justify-between items-baseline">'
            + '<span class="text-[10px] text-white/25">Period</span>'
            + '<span class="text-xs text-white/60 font-medium">' + Math.round(wp) + 's</span>'
            + '</div>';
        }

        if (sh != null) {
          html += '<div class="flex justify-between items-baseline">'
            + '<span class="text-[10px] text-white/25">Swell</span>'
            + '<span class="text-xs text-white/60 font-medium">' + sh.toFixed(1) + 'm</span>'
            + '</div>';
        }

        if (sd != null) {
          html += '<div class="flex justify-between items-baseline">'
            + '<span class="text-[10px] text-white/25">Direction</span>'
            + '<span class="text-xs text-white/60 font-medium">' + degToCompass(sd) + '</span>'
            + '</div>';
        }

        html += '</div>';
        el.innerHTML = html;
        scroll.appendChild(el);
      }

      scroll.addEventListener("scroll", function () {
        var fl = document.querySelector(".forecast-fade-left");
        if (fl) {
          if (scroll.scrollLeft > 10) fl.classList.remove("hidden");
          else fl.classList.add("hidden");
        }
      });
    }

    function fallback() {
      var wh = card.querySelector(".surf-live-wave-height");
      var wp = card.querySelector(".surf-live-wave-period");
      var sh = card.querySelector(".surf-live-swell-height");
      var sd = card.querySelector(".surf-live-swell-dir");
      if (wh && wh.textContent === "—") wh.textContent = "1.2 m";
      if (wp && wp.textContent === "—") wp.textContent = "10 s";
      if (sh && sh.textContent === "—") sh.textContent = "0.8 m";
      if (sd && sd.textContent === "—") sd.textContent = "SW";

      var placeholder = document.querySelector(".forecast-placeholder");
      if (placeholder) placeholder.innerHTML = '<p class="text-sm text-white/20">Forecast unavailable right now</p>';
    }

    var timeout = setTimeout(fallback, 6000);

    fetch(url)
      .then(function (r) { return r.json(); })
      .then(function (data) {
        clearTimeout(timeout);
        updateCurrent(data);
        buildForecast(data);
      })
      .catch(function () {
        clearTimeout(timeout);
        fallback();
      });
  })();
  </script>

  <style>
    .scrollbar-hide { -ms-overflow-style: none; scrollbar-width: none; }
    .scrollbar-hide::-webkit-scrollbar { display: none; }
  </style>
</CampLayout>
