---
import CampLayout from "@/components/layout/CampLayout.astro";
import BlockRenderer from "@/components/blocks/BlockRenderer.astro";
import CTASection from "@/components/sections/CTASection.astro";
import { getDestinations, getCampBySlug, getCampFoodPage } from "@/lib/sanity-data";
import { t } from "@/lib/i18n";

const lang = "de";

export async function getStaticPaths() {
  const allCamps = await getDestinations("de");
  return allCamps.map((d) => {
    const parts = d.slug.replace("/surfcamp/", "").split("/");
    return { params: { country: parts[0], camp: parts[1] } };
  });
}

const { country, camp } = Astro.params;
const campData = await getCampBySlug(camp!, lang);
const foodPage = await getCampFoodPage(camp!, lang);
const campTitle = foodPage?.campName || campData?.name || camp!.split("-").map((w: string) => w.charAt(0).toUpperCase() + w.slice(1)).join(" ");
const countryTitle = foodPage?.countryName || country!.split("-").map((w: string) => w.charAt(0).toUpperCase() + w.slice(1)).join(" ");
const bookingUrl = foodPage?.bookingUrl || campData?.bookingUrl || `https://bookings.rapturecamps.com/de/product/${country}-${camp}-surf-stay`;
const basePath = `/de/surfcamp/${country}/${camp}`;

const blocks = foodPage?.pageBuilder;
---

<CampLayout
  campName={campTitle}
  countryName={countryTitle}
  basePath={basePath}
  activePage="food"
  bookingUrl={bookingUrl}
  heroImages={foodPage?.heroImages || campData?.heroImages}
  heroTitle={foodPage?.heroTitle}
  title={`${t("camp.food_title", lang)} ${campTitle} | Rapture Surfcamps`}
  description={`${t("camp.food_title", lang)} ${campTitle} ${countryTitle}.`}
>
  {blocks?.length ? (
    <BlockRenderer blocks={blocks} campData={campData} />
  ) : (
    <CTASection />
  )}
</CampLayout>
