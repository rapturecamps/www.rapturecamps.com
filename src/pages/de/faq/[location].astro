---
import BaseLayout from "@/layouts/BaseLayout.astro";
import Breadcrumbs from "@/components/Breadcrumbs.astro";
import FAQSection from "@/components/sections/FAQSection.astro";
import { destinations } from "@/lib/data";
import { getDestinations, getFaqsByCamp } from "@/lib/sanity-data";

const lang = "de";

export async function getStaticPaths() {
  const camps = await getDestinations();
  const slugs = camps?.length
    ? camps.map((d: any) => d.slug.split("/").pop()!)
    : destinations.map((d) => d.slug.split("/").pop()!);
  return slugs.map((location: string) => ({ params: { location } }));
}

const { location } = Astro.params;
const camps = await getDestinations();
const campList = camps?.length ? camps : destinations;
const campData = campList.find((d: any) => d.slug.split("/").pop() === location);
const campName = campData?.name || location!.split("-").map((w: string) => w.charAt(0).toUpperCase() + w.slice(1)).join(" ");
const countryName = campData?.country || "";
const campImage = campData?.image || "https://images.unsplash.com/photo-1530053969600-caed2596d242?w=1920&h=600&fit=crop";
const campSlug = campData?.slug || `/surfcamp`;

const sanityFaqs = await getFaqsByCamp(location!, lang);

const hardcodedFaqs: Record<string, { question: string; answer: string }[]> = {
  "Buchung & Preise": [
    { question: "Wie buche ich ein Surfcamp?", answer: "Du kannst direkt über unsere Website buchen, indem du dein gewünschtes Camp und deine Daten auswählst. Eine Anzahlung ist erforderlich, um deinen Platz zu sichern. Der Restbetrag ist 30 Tage vor Anreise fällig." },
    { question: "Wie lauten die Stornierungsbedingungen?", answer: "Kostenlose Stornierung bis 30 Tage vor Check-in. Zwischen 30 und 14 Tagen gilt eine 50%ige Rückerstattung. Innerhalb von 14 Tagen vor Check-in sind Buchungen nicht erstattungsfähig." },
    { question: "Gibt es Gruppenrabatte?", answer: "Ja! Gruppen ab 4 Personen erhalten 10% Rabatt. Kontaktiere uns direkt für individuelle Gruppenpakete und Team-Retreats." },
  ],
  "Surfen & Unterricht": [
    { question: "Brauche ich Surferfahrung?", answer: "Überhaupt nicht. Unsere Camps heißen alle willkommen — vom kompletten Anfänger bis zum Fortgeschrittenen. Wir gruppieren den Unterricht nach Niveau, damit du immer in deinem eigenen Tempo lernst." },
    { question: "Welche Ausrüstung wird gestellt?", answer: "Die gesamte Surfausrüstung ist inklusive — Boards, Neoprenanzüge (wo nötig), Rashguards und Reef-Booties. Wir haben eine große Auswahl an Boardgrößen für alle Level." },
    { question: "Wie viele Surfstunden pro Tag?", answer: "Normalerweise zwei Sessions pro Tag — eine Morgensession (2–3 Stunden) und eine Nachmittagssession (1,5–2 Stunden). Du kannst an einer oder beiden teilnehmen." },
  ],
  "Zimmer": [
    { question: "Welche Zimmertypen gibt es?", answer: "Wir bieten Mehrbettzimmer (4–6 Betten), Doppelzimmer, Einzelzimmer und Glamping-Zelte je nach Standort. Alle beinhalten frische Bettwäsche, Handtücher und tägliche Reinigung." },
    { question: "Gibt es eine Klimaanlage?", answer: "Ja, alle Innenräume haben eine Klimaanlage. Glamping-Zelte nutzen natürliche Belüftung und Ventilatoren." },
  ],
  "Essen & Getränke": [
    { question: "Welche Mahlzeiten sind inklusive?", answer: "Frühstück und Abendessen (Mo–Fr) sind in allen Paketen enthalten. Das Frühstück bietet frisches Obst, Eier, Smoothie-Bowls und unbegrenzt Kaffee. Das Abendessen besteht aus drei Gängen mit wechselndem Menü." },
    { question: "Werden Ernährungswünsche berücksichtigt?", answer: "Absolut. Wir bieten vegetarische, vegane, glutenfreie Optionen und berücksichtigen die meisten Allergien. Gib uns einfach bei der Buchung Bescheid und unser Küchenteam kümmert sich darum." },
  ],
  "Anreise": [
    { question: "Bietet ihr Flughafentransfers an?", answer: "Ja, wir können Flughafentransfers gegen Aufpreis organisieren. Details und Preise variieren je nach Standort — schau auf der Camp-Seite nach oder kontaktiere uns nach der Buchung." },
    { question: "Wie komme ich zum Surfcamp?", answer: "Jede Camp-Seite enthält detaillierte Wegbeschreibungen. Die meisten Standorte sind per Taxi, Shuttle oder öffentlichen Verkehrsmitteln vom nächsten internationalen Flughafen erreichbar." },
  ],
};

const faqData = sanityFaqs || hardcodedFaqs;
---

<BaseLayout
  title={`FAQ — ${campName} | Rapture Surfcamps`}
  description={`Häufig gestellte Fragen zum Rapture Surf Camp ${campName} in ${countryName}. Buchung, Surfunterricht, Zimmer, Verpflegung und mehr.`}
  ogImage={campImage}
>
  <div class="relative h-[280px] sm:h-[320px] overflow-hidden">
    <div
      class="absolute inset-0 bg-cover bg-center bg-no-repeat"
      style={`background-image: url(${campImage.replace('w=800&h=1000', 'w=1920&h=600')})`}
    />
    <div class="absolute inset-0 bg-gradient-to-b from-dark/60 via-dark/40 to-dark" />
    <div class="relative z-10 flex flex-col justify-end h-full px-6 sm:px-12 lg:px-20 pb-10">
      <h1 class="font-display text-3xl sm:text-4xl md:text-5xl font-bold text-white">FAQ — {campName}</h1>
      <Breadcrumbs inline crumbs={[
        { label: "FAQ", href: "/de/faq" },
        { label: campName },
      ]} />
    </div>
  </div>

  <FAQSection grouped={faqData} />

  <section class="pb-16 sm:pb-20 bg-dark">
    <div class="px-6 sm:px-12 lg:px-20">
      <div class="rounded-2xl bg-white/[0.03] border border-white/[0.06] p-6 sm:p-8 text-center">
        <p class="text-white/50 text-sm mb-4">Noch Fragen? Schau dir das Camp an oder kontaktiere uns.</p>
        <div class="flex flex-wrap items-center justify-center gap-3">
          <a
            href={`/de${campSlug}`}
            class="inline-block rounded-full bg-white px-5 py-2 text-xs font-semibold text-brand-blue hover:bg-white/90 transition-colors"
          >
            {campName} besuchen
          </a>
          <a
            href="/de/contact"
            class="inline-block rounded-full bg-white/10 border border-white/10 px-5 py-2 text-xs font-semibold text-white hover:bg-white/20 transition-colors"
          >
            Kontakt
          </a>
        </div>
      </div>
    </div>
  </section>
</BaseLayout>
