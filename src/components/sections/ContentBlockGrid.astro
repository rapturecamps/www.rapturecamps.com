---
import { responsiveSrc } from "@/lib/image-utils";

interface Props {
  heading: string;
  body: string;
  images: { src: string; alt: string }[];
  reverse?: boolean;
  background?: "dark" | "dark-lighter";
  headingTag?: "h1" | "h2" | "h3" | "h4";
}

const {
  heading,
  body,
  images,
  reverse = false,
  background = "dark",
  headingTag = "h2",
} = Astro.props;

const HeadingTag = headingTag;
const bgClass = background === "dark-lighter" ? "bg-dark-lighter" : "bg-dark";
const rImages = images.map((img) => ({ ...img, ...responsiveSrc(img.src) }));
---

<section class:list={["py-16 sm:py-20", bgClass]}>
  <div class="px-6 sm:px-12 lg:px-20">
    {rImages.length > 0 ? (
      <div class:list={[
        "grid grid-cols-1 lg:grid-cols-2 gap-10 lg:gap-16 items-center",
        reverse && "direction-rtl"
      ]}>
        <div class:list={[reverse && "lg:order-2"]}>
          <HeadingTag class="text-2xl sm:text-3xl lg:text-4xl font-semibold text-white mb-6">{heading}</HeadingTag>
          <div class="text-base text-white/50 leading-relaxed space-y-4" set:html={body} />
        </div>
        <div class:list={[reverse && "lg:order-1"]}>
          {rImages.length === 2 && (
            <div class="grid grid-cols-2 gap-2 sm:gap-3">
              {rImages.map((img) => (
                <div class="aspect-[4/3] overflow-hidden rounded-xl">
                  <img src={img.src} srcset={img.srcset} sizes="(min-width: 1024px) 25vw, 50vw" alt={img.alt} class="h-full w-full object-cover" loading="lazy" />
                </div>
              ))}
            </div>
          )}
          {rImages.length === 3 && (
            <div class="grid grid-cols-1 gap-2 sm:gap-3">
              <div class="aspect-[21/9] overflow-hidden rounded-xl">
                <img src={rImages[0].src} srcset={rImages[0].srcset} sizes="(min-width: 1024px) 50vw, 100vw" alt={rImages[0].alt} class="h-full w-full object-cover" loading="lazy" />
              </div>
              <div class="grid grid-cols-2 gap-2 sm:gap-3">
                {rImages.slice(1).map((img) => (
                  <div class="aspect-[4/3] overflow-hidden rounded-xl">
                    <img src={img.src} srcset={img.srcset} sizes="(min-width: 1024px) 25vw, 50vw" alt={img.alt} class="h-full w-full object-cover" loading="lazy" />
                  </div>
                ))}
              </div>
            </div>
          )}
          {rImages.length >= 4 && (
            <div class="grid grid-cols-1 gap-2 sm:gap-3">
              <div class="aspect-[21/9] overflow-hidden rounded-xl">
                <img src={rImages[0].src} srcset={rImages[0].srcset} sizes="(min-width: 1024px) 50vw, 100vw" alt={rImages[0].alt} class="h-full w-full object-cover" loading="lazy" />
              </div>
              <div class="grid grid-cols-2 grid-rows-2 gap-2 sm:gap-3 aspect-[2/1]">
                <div class="row-span-2 overflow-hidden rounded-xl">
                  <img src={rImages[1].src} srcset={rImages[1].srcset} sizes="(min-width: 1024px) 25vw, 50vw" alt={rImages[1].alt} class="h-full w-full object-cover" loading="lazy" />
                </div>
                <div class="overflow-hidden rounded-xl">
                  <img src={rImages[2].src} srcset={rImages[2].srcset} sizes="(min-width: 1024px) 25vw, 50vw" alt={rImages[2].alt} class="h-full w-full object-cover" loading="lazy" />
                </div>
                <div class="overflow-hidden rounded-xl">
                  <img src={rImages[3].src} srcset={rImages[3].srcset} sizes="(min-width: 1024px) 25vw, 50vw" alt={rImages[3].alt} class="h-full w-full object-cover" loading="lazy" />
                </div>
              </div>
            </div>
          )}
        </div>
      </div>
    ) : (
      <div>
        <HeadingTag class="text-2xl sm:text-3xl lg:text-4xl font-semibold text-white mb-6">{heading}</HeadingTag>
        <div class="text-base text-white/50 leading-relaxed space-y-4" set:html={body} />
      </div>
    )}
  </div>
</section>
