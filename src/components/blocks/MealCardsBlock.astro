---
interface Props {
  block: any;
}

const { block } = Astro.props;
const bg = block.background === "dark-lighter" ? "bg-dark-lighter" : "bg-dark";
const meals = block.meals || [];

const mealIcons: Record<string, string> = {
  Breakfast: "M17 8h1a4 4 0 1 1 0 8h-1M3 8h14v9a4 4 0 0 1-4 4H7a4 4 0 0 1-4-4Z M6 2v4 M10 2v4 M14 2v4",
  Lunch: "M3 2v7c0 1.1.9 2 2 2h4a2 2 0 0 0 2-2V2M7 2v20M21 15V2v0a5 5 0 0 0-5 5v6c0 1.1.9 2 2 2h3Zm0 0v7",
  Dinner: "M3 2v7c0 1.1.9 2 2 2h4a2 2 0 0 0 2-2V2M7 2v20",
};

const fallbackImages = [
  "https://images.unsplash.com/photo-1504754524776-8f4f37790ca0?w=600&h=400&fit=crop",
  "https://images.unsplash.com/photo-1512621776951-a57141f2eefd?w=600&h=400&fit=crop",
  "https://images.unsplash.com/photo-1414235077428-338989a2e8c0?w=600&h=400&fit=crop",
];

function getMealIcon(mealName: string): string {
  return mealIcons[mealName] || mealIcons.Breakfast;
}

function getMealImage(meal: any, i: number): string {
  const url = meal.image?.asset?.url || meal.image;
  return url || fallbackImages[i % fallbackImages.length];
}
---

<section class:list={["py-16 sm:py-20", bg]}>
  <div class="px-6 sm:px-12 lg:px-20">
    <h2 class="text-2xl sm:text-3xl lg:text-4xl font-semibold text-white mb-10">Daily Meals</h2>
    <div class="space-y-8 lg:space-y-12">
      {meals.map((meal: any, i: number) => {
        const isOdd = i % 2 === 1;
        return (
          <div
            class:list={[
              "grid grid-cols-1 lg:grid-cols-5 gap-6 lg:gap-8 items-center",
              isOdd ? "lg:flex-row-reverse" : "",
            ]}
          >
            <div class:list={["lg:col-span-2", isOdd ? "lg:order-2" : ""]}>
              <div class="aspect-[4/3] rounded-xl overflow-hidden">
                <img
                  src={getMealImage(meal, i)}
                  alt={meal.meal || "Meal"}
                  class="h-full w-full object-cover"
                  loading="lazy"
                />
              </div>
            </div>
            <div class:list={["lg:col-span-3", isOdd ? "lg:order-1" : ""]}>
              <div class="flex items-center gap-3 mb-3">
                <div class="flex h-10 w-10 items-center justify-center rounded-lg bg-ocean-light/10 text-ocean-light">
                  <svg class="h-5 w-5" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
                    <path d={getMealIcon(meal.meal || "Breakfast")} />
                  </svg>
                </div>
                <h3 class="text-xl font-semibold text-white">{meal.meal || "Meal"}</h3>
              </div>
              {meal.time && <p class="text-ocean-light text-sm mb-3">{meal.time}</p>}
              {meal.desc && <p class="text-white/50 text-base leading-relaxed mb-4">{meal.desc}</p>}
              {(meal.highlights || []).length > 0 && (
                <div class="grid grid-cols-2 gap-2">
                  {meal.highlights.map((h: string) => (
                    <div class="flex items-start gap-2 text-sm text-white/60">
                      <svg class="h-4 w-4 mt-0.5 text-ocean-light flex-shrink-0" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M20 6 9 17l-5-5" />
                      </svg>
                      {h}
                    </div>
                  ))}
                </div>
              )}
            </div>
          </div>
        );
      })}
    </div>
  </div>
</section>
