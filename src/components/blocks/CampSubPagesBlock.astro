---
interface Props {
  block: {
    heading?: string;
    subtitle?: string;
    background?: "dark" | "dark-lighter";
    surfCard?: { title?: string; description?: string; imageUrl?: string };
    roomsCard?: { title?: string; description?: string; imageUrl?: string };
    foodCard?: { title?: string; description?: string; imageUrl?: string };
  };
  campData?: any;
}

const { block, campData } = Astro.props;

const currentPath = Astro.url.pathname;
const isDE = currentPath.startsWith("/de/");

const campName = campData?.name || "the Camp";
const countrySlug = campData?.countrySlug || campData?.slug?.split("/")?.[2] || "";
const campSlug = campData?.slug?.split("/")?.pop() || "";
const basePath = isDE
  ? `/de/surfcamp/${countrySlug}/${campSlug}`
  : `/surfcamp/${countrySlug}/${campSlug}`;

const heading = block.heading || (isDE ? "Entdecke das Camp" : "Explore the Camp");
const subtitle = block.subtitle || (isDE
  ? `Tauche tiefer ein in das, was dich in ${campName} erwartet.`
  : `Dive deeper into what awaits you at ${campName}.`);
const bgClass = block.background === "dark-lighter" ? "bg-dark-lighter" : "bg-dark";

const defaultSurfImage = "https://images.unsplash.com/photo-1502933691298-84fc14542831?w=600&h=400&fit=crop";
const defaultRoomsImage = "https://images.unsplash.com/photo-1582719478250-c89cae4dc85b?w=600&h=400&fit=crop";
const defaultFoodImage = "https://images.unsplash.com/photo-1504754524776-8f4f37790ca0?w=600&h=400&fit=crop";

const subPages = [
  {
    title: block.surfCard?.title || (isDE ? "Surfen" : "Surf"),
    href: `${basePath}/surf`,
    desc: block.surfCard?.description || (isDE
      ? "Entdecke die lokalen Breaks, Surfkurse und wie ein typischer Surftag aussieht."
      : "Explore the local breaks, lesson programmes, and what a typical surf day looks like."),
    image: block.surfCard?.imageUrl || defaultSurfImage,
    icon: "M2 6c.6.5 1.2 1 2.5 1C7 7 7 5 9.5 5c2.6 0 2.4 2 5 2 2.5 0 2.5-2 5-2 1.3 0 1.9.5 2.5 1M2 12c.6.5 1.2 1 2.5 1 2.5 0 2.5-2 5-2s2.4 2 5 2c2.5 0 2.5-2 5-2 1.3 0 1.9.5 2.5 1M2 18c.6.5 1.2 1 2.5 1 2.5 0 2.5-2 5-2s2.4 2 5 2c2.5 0 2.5-2 5-2 1.3 0 1.9.5 2.5 1",
  },
  {
    title: block.roomsCard?.title || (isDE ? "Zimmer" : "Rooms"),
    href: `${basePath}/rooms`,
    desc: block.roomsCard?.description || (isDE
      ? "Mehrbettzimmer, private Suiten, Glamping-Zelte — finde deine perfekte Unterkunft."
      : "Shared rooms, private suites, glamping tents — find your perfect fit."),
    image: block.roomsCard?.imageUrl || defaultRoomsImage,
    icon: "M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z M9 22V12h6v10",
  },
  {
    title: block.foodCard?.title || (isDE ? "Essen" : "Food"),
    href: `${basePath}/food`,
    desc: block.foodCard?.description || (isDE
      ? "Frische Mahlzeiten, wöchentliche Menüs und wie wir jede Ernährungsform berücksichtigen."
      : "Fresh meals, weekly menus, and how we cater for every dietary need."),
    image: block.foodCard?.imageUrl || defaultFoodImage,
    icon: "M18 8h1a4 4 0 0 1 0 8h-1M2 8h16v9a4 4 0 0 1-4 4H6a4 4 0 0 1-4-4V8z M6 1v3 M10 1v3 M14 1v3",
  },
];
---

<section class:list={["py-16 sm:py-20", bgClass]}>
  <div class="px-6 sm:px-12 lg:px-20">
    <h2 class="text-2xl sm:text-3xl lg:text-4xl font-semibold text-white mb-3">{heading}</h2>
    <p class="text-base text-white/40 mb-10 max-w-2xl">{subtitle}</p>
    <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
      {subPages.map((page) => (
        <a href={page.href} class="group rounded-xl overflow-hidden border border-white/5 bg-dark-lighter hover:border-white/10 transition-colors">
          <div class="aspect-[16/10] overflow-hidden">
            <img
              src={page.image}
              alt={page.title}
              class="h-full w-full object-cover transition-transform duration-500 group-hover:scale-105"
              loading="lazy"
            />
          </div>
          <div class="p-5">
            <div class="flex items-center gap-3 mb-2">
              <div class="flex h-8 w-8 items-center justify-center rounded-lg bg-white/5 text-white/40">
                <svg class="h-4 w-4" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
                  <path d={page.icon} />
                </svg>
              </div>
              <h3 class="text-base font-semibold text-white group-hover:text-ocean-light transition-colors">{page.title}</h3>
            </div>
            <p class="text-sm text-white/40 leading-relaxed">{page.desc}</p>
          </div>
        </a>
      ))}
    </div>
  </div>
</section>
